{% extends "base.html" %}
{% block content %}
<style>
    /* Special Dashboard Styling */
    .interactive-card {
        position: relative;
        overflow: hidden;
    }
    .interactive-card::after {
        content: "View List →";
        position: absolute;
        bottom: 25px;
        right: 25px;
        font-size: 13px;
        font-weight: 600;
        color: var(--accent);
        opacity: 0;
        transform: translateX(10px);
        transition: all 0.2s ease;
    }
    .interactive-card:hover::after {
        opacity: 1;
        transform: translateX(0);
    }
    
    /* Collapsible Modal/Lists inside Dashboard */
    .dashboard-list {
        margin-top: 35px;
    }
    .list-header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 15px;
    }
    .list-title { font-size: 18px; font-weight: 700; color: var(--text-main); }
    
    .scroll-table-container {
        background: white;
        border-radius: 16px;
        border: 1px solid #e5e5ea;
        max-height: 400px;
        overflow-y: auto;
    }
</style>

<div class="header">
    <h1>Dashboard</h1>
    <div>
        <a href="/plans" class="btn btn-secondary">Manage Plans</a>
        <a href="/members/new" class="btn btn-primary" style="margin-left: 10px;">+ New Member</a>
    </div>
</div>

<div class="stats-grid">
    <div class="card interactive-card" onclick="document.getElementById('listTotal').scrollIntoView({behavior: 'smooth'})">
        <h3>Total Members</h3>
        <div class="number">{{ total_members }}</div>
    </div>

    <div class="card interactive-card" onclick="document.getElementById('listActive').scrollIntoView({behavior: 'smooth'})">
        <h3>Active Members</h3>
        <div class="number">{{ active_members }}</div>
    </div>

    <div class="card interactive-card" onclick="document.getElementById('listCheckins').scrollIntoView({behavior: 'smooth'})">
        <h3>Check-ins Today</h3>
        <div class="number">{{ checkins_today }}</div>
    </div>
</div>

{% if upcoming_dues %}
<div class="card" style="margin-bottom: 30px; border-left: 5px solid var(--warning);">
    <h3 style="color: var(--warning);">⚠️ Fees Due Soon</h3>
    <table>
        <thead><tr><th>Member</th><th>Plan</th><th>Due Date</th><th>Status</th></tr></thead>
        <tbody>
            {% for m in upcoming_dues %}
            <tr>
                <td style="font-weight:600">{{ m['name'] }}</td>
                <td>{{ m['plan_name'] }}</td>
                <td>{{ m['expiry_date'] | format_date }}</td>
                <td style="color: {{ 'var(--danger)' if m['days_left'] < 0 else 'var(--warning)' }}; font-weight:600;">
                    {{ "Overdue" if m['days_left'] < 0 else "Due in " ~ m['days_left'] ~ " days" }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div id="listTotal" class="dashboard-list">
    <div class="list-header"><div class="list-title">All Members</div></div>
    <div class="scroll-table-container">
        <table>
            <thead><tr><th>Name</th><th>Phone</th><th>Status</th></tr></thead>
            <tbody>
                {% for m in all_members_list %}
                <tr>
                    <td style="font-weight:600;">{{ m['name'] }}</td>
                    <td>{{ m['phone'] }}</td>
                    <td>
                        <span style="padding:4px 10px; border-radius:12px; font-size:11px; font-weight:700; background:{{ '#e3f9e5' if m['status']=='Active' else '#fff0f0' }}; color:{{ 'var(--success)' if m['status']=='Active' else 'var(--danger)' }}">
                            {{ m['status'] }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="listCheckins" class="dashboard-list" style="margin-bottom: 50px;">
    <div class="list-header"><div class="list-title">Today's Check-ins</div></div>
    <div class="scroll-table-container">
        <table>
            <thead><tr><th>Time</th><th>Name</th><th>Plan</th></tr></thead>
            <tbody>
                {% if checkins_today > 0 %}
                    <tr><td colspan="3" style="text-align:center; padding:20px; color:#999;">Check Activity Log for details</td></tr>
                {% else %}
                    <tr><td colspan="3" style="text-align:center; padding:20px; color:#999;">No check-ins yet today.</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}